<select id="getLev1AuditFlowDetail"  parameterClass="java.util.Map" resultClass="java.util.HashMap" >
			<!-- with done_258 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258  where  iserialno= #WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
			),a as (
			select a.to_serialno,a.part,a.business_division from dwfformf8125802 d,audit_send_detail a where d.wf_serial_no = #WF_SERIAL_NO# and d.wf_num = a.serialno 
			 <isNotEmpty prepend="and" property="DEPT2NAME">
	              (a.part = #DEPT2NAME# or a.business_division = #DEPT2NAME#)
	         </isNotEmpty>
			and rownum = 1
			),done_259 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259 h,a  where  h.iserialno=a.to_serialno AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
			),b as(
			SELECT t.to_serialno from a,t_wf_relationship t,AUDIT_SEND_DETAIL d where t.from_serialno = a.to_serialno and  t.to_process = '81298' and d.TO_SERIALNO = t.TO_SERIALNO 
			<isNotEmpty prepend="and" property="DEPT3NAME">
	              (d.part = #DEPT3NAME# or d.business_division = #DEPT3NAME#)
	        </isNotEmpty>
			and rownum = 1
			),done_298 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 h,b where   h.iserialno=b.to_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
			),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			),r0 as(
			SELECT case when b.to_serialno is not null then b.TO_SERIALNO  when b.TO_SERIALNO is null and a.TO_SERIALNO is not null then a.TO_SERIALNO end serialno from a,b
			),r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select serialno from r0 ) 	ORDER BY ddatecreated desc
			)
			,r3 as (
			SELECT itaskid,icurractid,ddatecreated from r2 where rownum =1
			),r4 as(
			SELECT case when taskid2 is not null then taskid2 else taskid1 end taskid,ddatecreated from  (SELECT r3.itaskid taskid1,r1.ddatecreated ,r1.itaskid taskid2 FROM r3 ,r1 where r3.icurractid=r1.icurractid (+))
			)
			SELECT  r1.* from r1 ,r4 where r4.taskid  >r1.itaskid  or r1.ddatecreated>r4.ddatecreated
			union SELECT * FROM r2 where rownum=1 -->
			with done_258 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258  where  iserialno= #WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
			),a as (
			select a.to_serialno,a.part,a.business_division from dwfformf8125802 d,audit_send_detail a where d.wf_serial_no = #WF_SERIAL_NO# and d.wf_num = a.serialno 
			 <isNotEmpty prepend="and" property="DEPT2NAME">
	              (a.part = #DEPT2NAME# or a.business_division = #DEPT2NAME#)
	         </isNotEmpty>
			and rownum = 1
			),done_259 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259 h,a  where  h.iserialno=a.to_serialno AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
			),b as(
			SELECT t.to_serialno from a,t_wf_relationship t,AUDIT_SEND_DETAIL d where t.from_serialno = a.to_serialno and  t.to_process = '81298' and d.TO_SERIALNO = t.TO_SERIALNO 
			<isNotEmpty prepend="and" property="DEPT3NAME">
	              (d.part = #DEPT3NAME# or d.business_division = #DEPT3NAME#)
	        </isNotEmpty>
			and rownum = 1
			),done_298 as (
			SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 h,b where   h.iserialno=b.to_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
			),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			),r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select iserialno from r1 ) 	ORDER BY ddatecreated desc
			)
			SELECT * from r1 union select * from r2
	</select>
	<select id="getLev2AuditFlowDetail"  parameterClass="java.util.Map" resultClass="java.util.HashMap" >
		<!-- with done_259 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259  where  iserialno= #WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),a as ( 
		select d.wf_serial_no from dwfformf8125802 d,audit_send_detail a where a.to_serialno = #WF_SERIAL_NO# and d.wf_num = a.serialno and rownum = 1
		),done_258 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258 h,a  where  h.iserialno=a.wf_serial_no AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
		),b as(
		SELECT a.to_serialno from dwfformf8125902 d,audit_send_detail a where d.wf_num = a.serialno and d.wf_serial_no = #WF_SERIAL_NO#
		<isNotEmpty prepend="and" property="DEPT3NAME">
              (a.part = #DEPT3NAME# or a.business_division = #DEPT3NAME#)
        </isNotEmpty> 
		and rownum = 1
		),done_298 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 h,b where   h.iserialno=b.to_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			)
			,r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select iserialno from r1 ) 	ORDER BY ddatecreated desc
			)
			,r3 as (
			SELECT itaskid,icurractid,ddatecreated from r2 where rownum =1
			),r4 as(
			SELECT case when taskid2 is not null then taskid2 else taskid1 end taskid,ddatecreated from  (SELECT r3.itaskid taskid1,r1.ddatecreated ,r1.itaskid taskid2 FROM r3 ,r1 where r3.icurractid=r1.icurractid (+))
			)
			SELECT  r1.* from r1 ,r4 where r4.taskid  >r1.itaskid  or r1.ddatecreated>r4.ddatecreated
			union SELECT * FROM r2 where rownum=1 -->
		with done_259 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259  where  iserialno= #WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),a as ( 
		select d.wf_serial_no from dwfformf8125802 d,audit_send_detail a where a.to_serialno = #WF_SERIAL_NO# and d.wf_num = a.serialno and rownum = 1
		),done_258 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258 h,a  where  h.iserialno=a.wf_serial_no AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
		),b as(
		SELECT a.to_serialno from dwfformf8125902 d,audit_send_detail a where d.wf_num = a.serialno and d.wf_serial_no = #WF_SERIAL_NO#
		<isNotEmpty prepend="and" property="DEPT3NAME">
              (a.part = #DEPT3NAME# or a.business_division = #DEPT3NAME#)
        </isNotEmpty> 
		and rownum = 1
		),done_298 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 h,b where   h.iserialno=b.to_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			),r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select iserialno from r1 ) 	ORDER BY ddatecreated desc
			)
			SELECT * from r1 union select * from r2
	</select>
	<select id="getLev3AuditFlowDetail"  parameterClass="java.util.Map" resultClass="java.util.HashMap" >
		
		<!-- with done_298 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 where  iserialno=#WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),a as (
		SELECT DISTINCT t.from_serialno from t_wf_relationship t where t.to_serialno =#WF_SERIAL_NO#
		),done_259 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259 h,a  where  h.iserialno=a.from_serialno AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
		),b as(
		SELECT DISTINCT t.from_serialno from t_wf_relationship t,a where t.to_serialno = a.from_serialno
		),done_258 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258 h,b where   h.iserialno=b.from_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			),r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select iserialno from r1 ) 	ORDER BY ddatecreated desc
			)
			,r3 as (
			SELECT itaskid,icurractid,ddatecreated from r2 where rownum =1
			),r4 as(
			SELECT case when taskid2 is not null then taskid2 else taskid1 end taskid,ddatecreated from  (SELECT r3.itaskid taskid1,r1.ddatecreated ,r1.itaskid taskid2 FROM r3 ,r1 where r3.icurractid=r1.icurractid (+))
			)
			SELECT  r1.* from r1 ,r4 where r4.taskid  >r1.itaskid  or r1.ddatecreated>r4.ddatecreated
			union SELECT * FROM r2 where rownum=1 -->
		with done_298 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81298 where  iserialno=#WF_SERIAL_NO# AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),a as (
		SELECT DISTINCT t.from_serialno from t_wf_relationship t where t.to_serialno =#WF_SERIAL_NO#
		),done_259 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81259 h,a  where  h.iserialno=a.from_serialno AND   h.istaffid is not NULL GROUP BY h.icurractid ORDER BY h.icurractid
		),b as(
		SELECT DISTINCT t.from_serialno from t_wf_relationship t,a where t.to_serialno = a.from_serialno
		),done_258 as (
		SELECT icurractid,max(ddatecreated) ddatecreated FROM HAVEDONETASKS81258 h,b where   h.iserialno=b.from_serialno  AND   istaffid is not NULL GROUP BY icurractid ORDER BY icurractid
		),r1 as (SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81258 h,done_258 where h.ICURRACTID = done_258.icurractid AND h.ddatecreated = done_258.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,get_worktime ( to_char(h.ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( h.ddatecompleted, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime from HAVEDONETASKS81259 h,done_259 where h.ICURRACTID = done_259.icurractid AND h.ddatecreated = done_259.ddatecreated
			UNION
			SELECT itaskid,iserialno,h.icurractid,h.istaffid,to_char(h.ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,to_char(h.ddatecompleted,'yyyy-mm-dd hh24:mi:ss') ddatecompleted,0 worktime from HAVEDONETASKS81298 h,done_298 where h.ICURRACTID = done_298.icurractid AND h.ddatecreated = done_298.ddatecreated
			),r2 as(
			SELECT itaskid,iserialno,icurractid,istaffid,to_char(ddatecreated,'yyyy-mm-dd hh24:mi:ss')  ddatecreated,'' ddatecompleted,get_worktime ( to_char(ddatecreated, 'yyyy-mm-dd hh24:mi:ss' ), to_char( sysdate, 'yyyy-mm-dd hh24:mi:ss' ), NULL, NULL )/24 worktime FROM TO_DO_TASK_LIST where iserialno in (select iserialno from r1 ) 	ORDER BY ddatecreated desc
			)
			SELECT * from r1 union select * from r2
	</select>